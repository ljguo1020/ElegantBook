\elegant_provide_module:n{theorem}

% \g__elegant_theorem_mode_tl

\clist_new:N \g__elegant_theorem_mode_clist

\elegant_msg_new:nn { not support theorem mode }
  {
    The~theorem~mode~`#1'~is~not~support. \\
    Please~select~one~of~the~following~theorem~mode. \\
    \clist_use:Nn \g__elegant_theorem_mode_clist {,~} 
  }


\cs_new_protected_nopar:Npn \elegant_declare_theorem_mode:nn #1#2 
  {
    \tl_gset:cn { g_elegant_theorem_mode_#1_tl } { #2 }
    \clist_gput_right:Nn \g__elegant_theorem_mode_clist { #1 }
  }


\AddToHook{begindocument/before}
  {
    \tl_if_exist:cTF { g_elegant_theorem_mode_ \g__elegant_theorem_mode_tl _tl }
    {
      \tl_use:c { g_elegant_theorem_mode_ \g__elegant_theorem_mode_tl _tl }
    }
    {
      % error / message
      \elegant_msg_error:nx { not support theorem mode } { \g__elegant_theorem_mode_tl }
    }
  }

\elegant_declare_theorem_mode:nn { fancy }
  {
    \@ifpackageloaded{tcolorbox}
      {
        \tcbuselibrary{many}
      }
      {
        \RequirePackage[many]{tcolorbox}
      }
    
    \tcbset{
      common /.style = {
        fontupper = \itshape,
        lower~separated = false,
        coltitle = white,
        boxrule = 0.5pt,
        fonttitle = \bfseries,
        enhanced,
        breakable,
        top = 8pt,
        before~skip = 8pt,
        attach~boxed~title~to~top~left = {
          yshift = -0.11in,
          xshift = 0.15in
        },
        boxed~title~style = {
          boxrule = 0pt,
          colframe = white,
          arc = 0pt,
          outer~arc = 0pt
        },
        separator~sign={.}
      }
    }
    % #1, name
    \NewDocumentCommand \elegantnewtheorem { m O{chapter} }
      {
        \newcounter{ #1 }
        \counterwithin{ #1 } { #2 }
        \DeclareDocumentEnvironment{#1}{ o }
        {
          \refstepcounter{ #1 }
          \begin{tcolorbox}[
            common,
            colframe = \elegant_use_color:n { #1 },
            colback = \elegant_use_color:n { #1 }!5,
            colbacktitle = \elegant_use_color:n { #1 },
            title = \elegant_use_name:n { #1 } \use:c { the#1 } \ \IfNoValueF{##1}{(##1)},
            overlay~unbroken~and~last = {
              \node[anchor = south~east, outer~sep = 0pt, text = \elegant_use_color:n { #1 }] at (\linewidth-width, 0) 
              { \elegant_use_name:n { #1 / icon } };
            }
          ]
        }
        {
          \end{tcolorbox}
        }
      }
    % define the tcbs
    \clist_map_inline:nn 
      { theorem, definition, postulate, axiom, corollary, lemma, proposition }
      {
        \elegantnewtheorem { #1 }
      }

  }